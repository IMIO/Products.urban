<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="urban">

<metal:block fill-slot="top_slot"
             tal:define="global parcels context/getParcels" />

<head>
<div tal:condition="context/getParcels" metal:fill-slot="style_slot" >
    <div metal:use-macro="here/urban_macros/macros/urbanMapCSS" />
</div>
<div tal:condition="context/getParcels" metal:fill-slot="javascript_head_slot" tal:define="webserverhost python: context.portal_urban.getWebServerHost();">
    <div metal:use-macro="here/urban_macros/macros/urbanMapScript" />
</div>
</head>

<body>

<div metal:fill-slot="main">
<metal:main_macro define-macro="main">
    <metal:body define-macro="body_macro" tal:define="applicants context/getApplicants;">

<tal:block condition="python: not parcels or not applicants">
 <div metal:use-macro="here/urban_macros/macros/urbanPortalMessageMacro" />
</tal:block>

<h1 class="documentFirstHeading">
 <tal:block replace="structure python:getattr(here, here.getIcon(1))"/>
 <span tal:replace="here/Title" tal:omit-tag="">Title</span>
</h1>

<u><b><span i18n:translate="treating_agent">Treating agent</span> :</b></u><br>
<p tal:condition="context/getFoldermanagers" tal:content="python: here.getFoldermanagers().getName1()+' '+here.getFoldermanagers().getName2()">Treating agent name</p>

<table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td valign="top" width=50%>
   <fieldset><b><legend i18n:translate="applicants">Applicant(s)</legend></b>
    <div metal:use-macro="here/urban_macros/macros/urbanApplicantsMacro" />
   </fieldset>
  </td>
  <td width=1%></td>
  <td valign="top" width=50%>
   <fieldset><b><legend i18n:translate="urban_label_notaryContact">Notary(ies)</legend></b>
    <div metal:use-macro="here/urban_macros/macros/urbanNotariesMacro" />
   </fieldset>
  </td>
 </tr>
 </table>

 <fieldset style="margin-top: 0;"><strong><legend i18n:translate="legend_details">Details</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td colspan=2>
   <u><b><span i18n:translate="urban_label_reference">Commune reference</span> :</b></u>
   <metal:myfield use-macro="python:here.widget('reference', mode='view')" />
  </td>
 </tr>
 <tr>
  <td colspan=2>
   <u><b><span i18n:translate="urban_label_specificFeatures">Specific features</span> :</b></u>
   <metal:myfield use-macro="python:here.widget('specificFeatures', mode='view')" />
  </td>
 </tr>
 </table>
 </fieldset>

 <fieldset><strong><legend i18n:translate="legend_situation">Situation</legend></strong>
  <table cellspacing=0 cellpadding=0 width=100%>
   <tr>
    <td colspan=2>
     <div metal:use-macro="here/urban_macros/macros/urbanWorkLocation" />
    </td>
   </tr>
  </table>
 </fieldset>
 
 <fieldset><strong><legend i18n:translate="concerned_parcels">Concerned parcel(s)</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
  <tr>
   <td>
   <div class="#" tal:attributes="class python: test(parcels, 'field', 'field warning')">
    <div tal:condition="not: parcels" i18n:translate="warning_add_a_parcel">You must encode concerned parcel(s)
    </div>
    <div tal:define="tool python: getattr(context, 'portal_urban');
                     topic python: getattr(tool.topics, 'searchportionsout');
                     path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                     dummy python: context.setPathCritValue(path_crit, context.UID());
                     showActions python: True;
                     showedCols python: ('Title', 'Creator');">
    <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
    <p>
     <form i18n:domain="urban" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/checkPortionsOutSearch'" action="checkPortionsOutSearch" method="post" tal:define="ctype python: context.portal_types.getTypeInfo('PortionOut')">
      <img src="#" title="#" tal:attributes="src python: ctype.getIcon(); title ctype/description" i18n:attributes="title" />
      <input type="hidden" name="type_name" value="#" tal:attributes="value ctype/id" />
      <input type="submit" class="standalone" id="event" value="search_parcels" i18n:attributes="value" />
     </form>
    </p>
   </div>

   <div tal:condition="not: parcels">
    <p class="discreet" i18n:translate="cartography_map_descr">A map will me displayed when you will have defined concerned parcels</p>
   </div>
   <tal:block condition="parcels">
   <form>
    <input type="hidden" id="map_initialized" value="0" />
   </form>
   <p i18n:translate="cartography" class="discreet">Cartography</p>
   <div id="urbanmapctn" style="width:100%; height:800px"></div>
   </tal:block>

  </td>
 </tr>
 </table>
 </fieldset>

<fieldset><strong><legend i18n:translate="folder_events">Folder events</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td>
    <div tal:define="tool python: getattr(context, 'portal_urban');
                     topic python: getattr(tool.topics, 'searchurbanevents');
                     path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                     dummy python: context.setPathCritValue(path_crit, context.UID());
                     showActions python: True;">
    <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
  </td>
 </tr>
 <tr>
  <td>
   <metal:events use-macro="here/urban_macros/macros/urbanEventsMacro" />
  </td>
 </tr>
 </table>
</fieldset>

<div tal:replace="structure provider:plone.belowcontentbody" />

</metal:body>
</metal:main_macro>
</div>
</body>
</html>
