<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body>

<div metal:fill-slot="top_slot">
<metal:block metal:use-macro="here/global_defines/macros/defines" />
<div tal:define="member context/@@plone_portal_state/member;
                 dummy python:request.set(test(member.has_permission('Manage portal', here), 'enable_border', 'disable_border'), 1);" />
</div>

<div metal:fill-slot="main">
<metal:main_macro define-macro="main">
    <metal:body define-macro="body_macro"
                tal:define="kssClassesView context/@@kss_field_decorator_view;
                            getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                            templateId template/getId;
                            isAnon python: context.portal_membership.isAnonymousUser();
                            urban_root python: not context.getProperty('urbanConfigId');
                            portalAbsoluteUrl python: context.portal_url.getPortalObject().absolute_url()">

        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading">
            <metal:field use-macro="python:here.widget('title', mode='view')">
            Title
            </metal:field>
        </h1>

        <!--div tal:replace="structure provider:plone.belowcontenttitle" /-->

        <p class="documentDescription">
            <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
            </metal:field>
        </p>

        <div tal:condition="urban_root" i18n:domain="urban">
        <table width=100%>
            <tr valign=top>
                <td width=34% valign=top>
                 <img src="../BuildLicence.png" /> <a href="buildlicences" i18n:translate="buildlicences">Build licences</a><a href="" tal:condition="python: 'BuildLicence' in [t.id for t in getattr(context, 'buildlicences').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/buildlicences/createObject?type_name=BuildLicence'"><img src="icon_add.gif" /></a><br/>
                 <img src="../ParcelOutLicence.png" /> <a href="parceloutlicences" i18n:translate="parceloutlicences">ParcelOut licences</a><a href="" tal:condition="python: 'ParcelOutLicence' in [t.id for t in getattr(context, 'parceloutlicences').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/parceloutlicences/createObject?type_name=ParcelOutLicence'"><img src="icon_add.gif" /></a><br/>
                 <img src="../Declaration.gif" /> <a href="declarations" i18n:translate="declarations">Declarations</a><a href="" tal:condition="python: 'Declaration' in [t.id for t in getattr(context, 'declarations').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/declarations/createObject?type_name=Declaration'"><img src="icon_add.gif" /></a><br/>
                 <img src="../division.png" /> <a href="divisions" i18n:translate="divisions">Divisions</a><a href="" tal:condition="python: 'Division' in [t.id for t in getattr(context, 'divisions').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/divisions/createObject?type_name=Division'"><img src="icon_add.gif" /></a><br/>
                 <img src="../NotaryLetter.png" /> <a href="notaryletters" i18n:translate="notaryletters">Notary letters</a><a href="" tal:condition="python: 'NotaryLetter' in [t.id for t in getattr(context, 'notaryletters').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/notaryletters/createObject?type_name=NotaryLetter'"><img src="icon_add.gif" /></a><br/>
                 <img src="../UrbanCertificateOne.png" /> <a href="urbancertificateones" i18n:translate="urbancertificateones">Urban certificate 1</a><a href="" tal:condition="python: 'UrbanCertificateOne' in [t.id for t in getattr(context, 'urbancertificateones').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/urbancertificateones/createObject?type_name=UrbanCertificateOne'"><img src="icon_add.gif" /></a><br/>
                 <img src="../UrbanCertificateTwo.png" /> <a href="urbancertificatetwos" i18n:translate="urbancertificatetwos">Urban certificate 2</a><a href="" tal:condition="python: 'UrbanCertificateTwo' in [t.id for t in getattr(context, 'urbancertificatetwos').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/urbancertificatetwos/createObject?type_name=UrbanCertificateTwo'"><img src="icon_add.gif" /></a><br/>
                 <img src="../EnvironmentalDeclaration.png" /> <a href="environmentaldeclarations" i18n:translate="environmentaldeclarations">Environmental declarations</a><a href="" tal:condition="python: 'EnvironmentalDeclaration' in [t.id for t in getattr(context, 'environmentaldeclarations').allowedContentTypes()]" tal:attributes="href python: context.absolute_url() + '/environmentaldeclarations/createObject?type_name=EnvironmentalDeclaration'"><img src="icon_add.gif" /></a><br/>
                </td>
                <td width=33%>
                 <img src="../link_icon.gif" /> <a href="urban_searchbyparcel" i18n:translate="urban_searchbyparcel_descr">Search by parcel</a><br/>
                 <img src="../link_icon.gif" /> <a href="urban_searchbyapplicant" i18n:translate="urban_searchbyapplicant_descr">Search by applicant</a><br/>
                 <img src="../link_icon.gif" /> <a href="urban_searchbystreet" i18n:translate="urban_searchbystreet_descr">Search by street</a><br/>
                 <img src="../engrenage.png" /> <a href="exportUrbain" i18n:translate="urban_export_list220">Export list 220</a><br/>
                 <img src="../engrenage.png" /> <a href="statsins" i18n:translate="urban_statistics_ins">Statistics INS</a><br/>
                </td>
                <td width=33%>
                 <img src="../folder_icon.gif" /> <a href="architects" i18n:translate="manage_architects">Manage architects</a><br/>
                 <img src="../folder_icon.gif" /> <a href="notaries" i18n:translate="manage_notaries">Manage notaries</a><br/>
                 <img src="../folder_icon.gif" /> <a href="geometricians" i18n:translate="manage_geometricians">Manage geometricians</a><br/>
                 
                </td>
            </tr>
        </table>
        </div>

        <div class="field" tal:condition="not: urban_root">
        <tal:addable_types define="acts context/allowedContentTypes" repeat="act acts" i18n:domain="urban">
         <form tal:condition="python: not isAnon" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/createObject'" action="createObject" method="post">
          <img src="#" title="#" tal:define="ctype python: context.portal_types.getTypeInfo(act.id)" tal:attributes="src python: portalAbsoluteUrl + '/' + ctype.getIcon(); title ctype/description" i18n:attributes="title" />
          <input type="hidden" name="type_name" value="#" tal:attributes="value act/id" />
          <input type="submit" class="standalone" id="event" value="#" tal:attributes="value python: 'add_' + act.id" i18n:attributes="value" />
         </form>
        </tal:addable_types>
        </div>

        <div tal:replace="structure provider:plone.abovecontentbody" />

        <fieldset tal:define="tool python: getattr(context, 'portal_urban');
                              urbanConfig python:tool.getUrbanConfig(context);">
         <tal:not_urban_root condition="not: urban_root" define="default_name python: 'searchalllicences';">
         <strong><legend i18n:domain="urban" i18n:translate="" tal:content="python: urbanConfig.getId()+'_'+(request.get('search') or default_name)">Title</legend></strong>
         <div tal:define="topics python: getattr(urbanConfig, 'topics');
                          name request/search|default_name;
                          topic python: getattr(topics, name);
                          path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                          dummy python: context.setPathCritValue(path_crit, context.UID());
                          showActions python: True;">
          <tal:block condition="not: python: context.portal_quickinstaller.isProductInstalled('PloneTask') and context.portal_urban.getUsePloneTask()">
           <metal:listing use-macro="here/urban_macros/macros/listing" />
          </tal:block>
          <tal:block condition="python: context.portal_quickinstaller.isProductInstalled('PloneTask') and context.portal_urban.getUsePloneTask()">
           <metal:listing use-macro="here/urban_macros/macros/integratePloneTask" />
          </tal:block>
         </div>

         </tal:not_urban_root>
         <tal:urban_root condition="urban_root" define="default_name python: 'search-last-elements'">
         <strong><legend i18n:domain="urban" i18n:translate="" tal:content="python: request.get('search') or default_name">Title</legend></strong>
         <div tal:define="topics python: getattr(tool, 'topics');
                          name request/search|default_name;
                          topic python: getattr(topics, name);
                          path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                          dummy python: context.setPathCritValue(path_crit, context.UID());
                          showActions python: True;">
          <tal:block condition="not: python: context.portal_quickinstaller.isProductInstalled('PloneTask') and context.portal_urban.getUsePloneTask()">
           <metal:listing use-macro="here/urban_macros/macros/listing" />
          </tal:block>
          <tal:block condition="python: context.portal_quickinstaller.isProductInstalled('PloneTask') and context.portal_urban.getUsePloneTask()">
           <metal:listing use-macro="here/urban_macros/macros/integratePloneTask" />
          </tal:block>
         </div>
         </tal:urban_root>

         </fieldset>

    </metal:body>
    <div tal:replace="structure provider:plone.belowcontentbody" />

</metal:main_macro>

</div>

</body>
</html>
