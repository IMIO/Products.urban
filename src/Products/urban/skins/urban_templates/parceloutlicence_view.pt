<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="urban">

<metal:block fill-slot="top_slot"
             tal:define="global parcels context/getParcels" />

<head>
<div tal:condition="context/getParcels" metal:fill-slot="style_slot" >
    <div metal:use-macro="here/urban_macros/macros/urbanMapCSS" />
</div>
<div tal:condition="context/getParcels" metal:fill-slot="javascript_head_slot" tal:define="webserverhost python: context.portal_urban.getWebServerHost();">
    <div metal:use-macro="here/urban_macros/macros/urbanMapScript" />
</div>
</head>

<body>

<div metal:fill-slot="main">
<metal:main_macro define-macro="main">
    <metal:body define-macro="body_macro" tal:define="applicants context/getApplicants;">

<tal:block condition="python: not parcels or not applicants">
 <div metal:use-macro="here/urban_macros/macros/urbanPortalMessageMacro" />
</tal:block>

<h1 class="documentFirstHeading">
 <tal:block replace="structure python:getattr(here, here.getIcon(1))"/>
 <span tal:replace="here/Title" tal:omit-tag="">Title</span>
</h1>

<fieldset><legend><strong tal:content="context/getLicenceSubject">Subject</strong></legend>
<span class="discreet" tal:content="structure context/Description">Description</span>
</fieldset>

<div metal:use-macro="here/urban_macros/macros/urbanFolderManagerMacro" />

<table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td valign="top" width=49%>
   <fieldset><b><legend i18n:translate="applicants">Applicant(s)</legend></b>
    <div metal:use-macro="here/urban_macros/macros/urbanApplicantsMacro" />
   </fieldset>
  </td>
  <td width="1%"></td>
  <td valign="top" width=50%>
   <fieldset><b><legend i18n:translate="urban_label_geometricians">Geometrician(s)</legend></b>
    <div metal:use-macro="here/urban_macros/macros/urbanGeometriciansMacro" />
   </fieldset>
  </td>
 </tr>
 </table>
 <fieldset><strong><legend i18n:translate="legend_details">Details</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td colspan=2>
   <u><b><span i18n:translate="urban_label_reference">Commune reference</span> :</b></u>
   <metal:myfield use-macro="python:here.widget('reference', mode='view')" />
   <u><b><span i18n:translate="urban_label_referenceDGATLP">DGATLP reference</span> :</b></u>
   <metal:myfield use-macro="python:here.widget('referenceDGATLP', mode='view')" />
  </td>
 </tr>
 <tr>
  <td colspan=2>
   <br>
   <u><b><span i18n:translate="urban_label_folderCategory">Folder category</span> :</b></u><br>
   <metal:myfield use-macro="python:here.widget('folderCategory', mode='view')" />
  </td>
 </tr>
 </table>
 </fieldset>
 <fieldset><strong><legend i18n:translate="legend_situation">Situation</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td colspan=2>
   <div metal:use-macro="here/urban_macros/macros/urbanWorkLocation" />
  <td>
 </tr>

 </table>
 </fieldset>
 <p><u><b><span i18n:translate="urban_label_derogation">Derogations</span> :</b></u>
 <br /><metal:myfield use-macro="python:here.widget('derogation', mode='view')" /><span tal:condition="not: python: context.derogation" class="discreet" i18n:translate="content_none">None</span></p>
 <fieldset><strong><legend i18n:translate="concerned_parcels">Concerned parcel(s)</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
  <tr>
   <td>
   <div class="#" tal:attributes="class python: test(parcels, 'field', 'field warning')">
    <div tal:condition="not: parcels" i18n:translate="warning_add_a_parcel">You must encode concerned parcel(s)
    </div>
    <div tal:define="tool python: getattr(context, 'portal_urban');
                     topic python: getattr(tool.topics, 'searchportionsout');
                     path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                     dummy python: context.setPathCritValue(path_crit, context.UID());
                     showActions python: True;
                     showedCols python: ('Title', 'Creator');">
    <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
    <p>
     <form i18n:domain="urban" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/checkPortionsOutSearch'" action="checkPortionsOutSearch" method="post" tal:define="ctype python: context.portal_types.getTypeInfo('PortionOut')">
      <img src="#" title="#" tal:attributes="src python: ctype.getIcon(); title ctype/description" i18n:attributes="title" />
      <input type="hidden" name="type_name" value="#" tal:attributes="value ctype/id" />
      <input type="submit" class="standalone" id="event" value="search_parcels" i18n:attributes="value" />
     </form>
    </p>
   </div>

   <div tal:condition="not: parcels">
    <p class="discreet" i18n:translate="cartography_map_descr">A map will me displayed when you will have defined concerned parcels</p>
   </div>
   <tal:block condition="parcels">
   <form>
    <input type="hidden" id="map_initialized" value="0" />
   </form>
   <p i18n:translate="cartography" class="discreet">Cartography</p>
   <div id="urbanmapctn" style="width:100%; height:800px"></div>
   </tal:block>

  </td>
 </tr>
 </table>
 
 </fieldset>
 
<fieldset><strong><legend i18n:translate="legend_lots">Lots</legend></strong>
 <div tal:define="tool python: getattr(context, 'portal_urban');
                     topic python: getattr(tool.topics, 'searchlots');
                     path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                     dummy python: context.setPathCritValue(path_crit, context.UID());
                     showActions python: False;
                     isALot python: True;">
    <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
 
 <form i18n:domain="urban" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/createObject'" action="createObject" method="post" tal:define="ctype python: context.portal_types.getTypeInfo('Lot')">
 <img src="#" title="#" tal:attributes="src python: ctype.getIcon(); title ctype/description" i18n:attributes="title" />
 <input type="hidden" name="type_name" value="#" tal:attributes="value ctype/id" />
 <input type="submit" class="standalone" id="event" value="add_a_lot" i18n:attributes="value" />
 </form>
 
 </fieldset>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td colspan=2>
   <tal:block condition="python: context.getInvestigationStart()">
    <fieldset><strong><legend i18n:translate="legend_investigation">Public inquiry</legend></strong>
    <table cellspacing=0 cellpadding=0>
     <tr>
      <td>
       <strong><span i18n:translate="urban_label_investigationArticles">Investigation articles</span>&nbsp;</strong></td><td><metal:myfield use-macro="python:here.widget('investigationArticles', mode='view')" />
      </td>
     </tr>
    </table>
    <table cellspacing=0 cellpadding=0>
     <tr>
      <td>
       <strong><span i18n:translate="inquiry_from">from</span>&nbsp;</strong>
      </td>
      <td>
       <metal:myfield use-macro="python:here.widget('investigationStart', mode='view')" />
      </td>
      <td>
       <strong>&nbsp;<span i18n:translate="inquiry_to">to</span>&nbsp;</strong>
      </td>
      <td>
       <metal:myfield use-macro="python:here.widget('investigationEnd', mode='view')" />
      </td>
     </tr>
    </table>
    </fieldset>
   </tal:block>
   <fieldset><strong><legend i18n:translate="legend_equipments">Equipments</legend></strong>
   <div tal:define="tool python: getattr(context, 'portal_urban');
                     topic python: getattr(tool.topics, 'searchequipments');
                     path_crit python: getattr(topic, 'crit__path_ATPathCriterion');
                     dummy python: context.setPathCritValue(path_crit, context.UID());
                     showActions python: False;
                     isALot python: False;
                     isAnEquipment python: True;">
    <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
    
    <form i18n:domain="urban" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/createObject'" action="createObject" method="post" tal:define="ctype python: context.portal_types.getTypeInfo('Equipment')">
    <img src="#" title="#" tal:attributes="src python: ctype.getIcon(); title ctype/description" i18n:attributes="title" />
    <input type="hidden" name="type_name" value="#" tal:attributes="value ctype/id" />
    <input type="submit" class="standalone" id="event" value="add_an_equipment" i18n:attributes="value" />
    </form>
    </fieldset>
   <fieldset><strong><legend i18n:translate="legend_road">Road</legend></strong>
    <b i18n:translate="">Road type</b> :
    <br /><metal:myfield use-macro="python:here.widget('roadType', mode='view')" />
    <b i18n:translate="">Road coating</b> :
    <br /><metal:myfield use-macro="python:here.widget('roadCoating', mode='view')" />
     <p tal:condition="not: python: context.roadCoating" class="discreet" i18n:translate="content_none">None</p>
    <b i18n:translate="">Road equipments</b> :
    <br /><metal:myfield use-macro="python:here.widget('roadEquipments', mode='view')" />
    <p tal:condition="not: python: context.roadEquipments" class="discreet" i18n:translate="content_none">None</p>
    <br /><b i18n:translate="urban_label_roadAdaptation">Road adaptation</b> :
   </fieldset>
   <br /><b><u><span i18n:translate="urban_label_solicitOpinionsTo">Solicit opinion to</span> :</u></b>
   <br /><metal:myfield use-macro="python:here.widget('solicitOpinionsTo', mode='view')" />
   <span tal:condition="not: python: context.solicitOpinionsTo" class="discreet" i18n:translate="content_none">None</span><br />
   <br /><b><u><span i18n:translate="urban_label_folderZone">Folder zone</span> :</u></b>
   <br /><metal:myfield use-macro="python:here.widget('folderZone', mode='view')" />

   <br /><b><u><span i18n:translate="urban_label_impactStudy">Impact study</span> :</u></b>
   <br /><metal:myfield use-macro="python:here.widget('impactStudy', mode='view')" /><br />
   <strong><u i18n:translate="urban_label_annoncedDelay">Deadline delay</u></strong><br />
   <metal:myfield use-macro="python:here.widget('annoncedDelay', mode='view')" />
  </td>
 </tr>
 </table>

<fieldset><strong><legend i18n:translate="folder_events">Folder events</legend></strong>
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td>
    <div tal:define="specificSearch python: 'searchUrbanEvents';
                     tool python: context.portal_urban;
                     showedCols python: ('Title', 'getBeginDate', 'getEndDate', 'Creator', );
                     topic python: None;
                     showActions python: True;
                     theObjects python: False;
                     batchlen python: 50">
     <metal:listing use-macro="here/urban_macros/macros/listing" />
    </div>
  </td>
 </tr>
 <tr>
  <td>
   <metal:events use-macro="here/urban_macros/macros/urbanEventsMacro" /> 
  </td>
 </tr>
 </table>
</fieldset>

<div tal:replace="structure provider:plone.belowcontentbody" />

</metal:body>
</metal:main_macro>
</div>
</body>
</html>
