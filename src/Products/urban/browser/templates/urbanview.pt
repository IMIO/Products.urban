<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body>

<div metal:fill-slot="top_slot">
<metal:block metal:use-macro="here/global_defines/macros/defines" />
<div tal:define="member context/@@plone_portal_state/member;
                 dummy python:request.set((member.has_permission('Manage portal', here) and 'enable_border' or 'disable_border'), 1);" />
</div>

<div metal:fill-slot="main">
<metal:main_macro define-macro="main">
    <metal:body define-macro="body_macro"
                tal:define="kssClassesView context/@@kss_field_decorator_view;
                            getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                            isAnon context/@@plone_portal_state/anonymous;
                            urban_root python: not context.getProperty('urbanConfigId');
                            portal_url context/@@plone_portal_state/portal_url;
                            isUrbanManager view/isUrbanManager">

        <div tal:replace="structure provider:plone.abovecontenttitle" />

        <h1 class="documentFirstHeading">
            <metal:field use-macro="python:here.widget('title', mode='view')">
            Title
            </metal:field>
            <tal:add_icon condition="not: urban_root">
              <tal:addable_types define="acts context/allowedContentTypes" repeat="act acts" i18n:domain="urban">
               <a href="#" tal:attributes="href python: context.absolute_url() + '/createObject?type_name=' + act.id">
                <img class="urban-add-icon-big" src="#" tal:attributes="src string:${portal_url}/icon_add_big.png" />
               </a>
              </tal:addable_types>
            </tal:add_icon>
        </h1>

        <!--div tal:replace="structure provider:plone.belowcontenttitle" /-->

        <p class="documentDescription">
            <metal:field use-macro="python:here.widget('description', mode='view')">
            Description
            </metal:field>
        </p>

        <div tal:condition="urban_root" i18n:domain="urban">
        <table width=100%>
            <tr valign=top>
                <td width=34% valign=top>
                 <a class="contenttype-buildlicence" href="buildlicences" i18n:translate="buildlicences">Build licences</a>
                 <a href="" tal:condition="python: 'BuildLicence' in [t.id for t in getattr(context, 'buildlicences').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/buildlicences/createObject?type_name=BuildLicence'">
                    <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-parceloutlicence" href="parceloutlicences" i18n:translate="parceloutlicences">ParcelOut licences</a>
                 <a href="" tal:condition="python: 'ParcelOutLicence' in [t.id for t in getattr(context, 'parceloutlicences').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/parceloutlicences/createObject?type_name=ParcelOutLicence'">
                    <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-declaration" href="declarations" i18n:translate="declarations">Declarations</a>
                 <a href="" tal:condition="python: 'Declaration' in [t.id for t in getattr(context, 'declarations').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/declarations/createObject?type_name=Declaration'">
                            <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-division" href="divisions" i18n:translate="divisions">Divisions</a>
                 <a href="" tal:condition="python: 'Division' in [t.id for t in getattr(context, 'divisions').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/divisions/createObject?type_name=Division'">
                    <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-notaryletter" href="notaryletters" i18n:translate="notaryletters">Notary letters</a>
                 <a href="" tal:condition="python: 'NotaryLetter' in [t.id for t in getattr(context, 'notaryletters').allowedContentTypes()]"
                           tal:attributes="href python: context.absolute_url() + '/notaryletters/createObject?type_name=NotaryLetter'">
                    <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-urbancertificateone" href="urbancertificateones" i18n:translate="urbancertificateones">Urban certificate 1</a>
                 <a href="" tal:condition="python: 'UrbanCertificateOne' in [t.id for t in getattr(context, 'urbancertificateones').allowedContentTypes()]"
                           tal:attributes="href python: context.absolute_url() + '/urbancertificateones/createObject?type_name=UrbanCertificateOne'">
                    <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-urbancertificatetwo" href="urbancertificatetwos" i18n:translate="urbancertificatetwos">Urban certificate 2</a>
                 <a href="" tal:condition="python: 'UrbanCertificateTwo' in [t.id for t in getattr(context, 'urbancertificatetwos').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/urbancertificatetwos/createObject?type_name=UrbanCertificateTwo'">
                   <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>
                 <a class="contenttype-envclassthree" href="envclassthrees" i18n:translate="envclassthrees">Environmental declarations</a>
                 <a href="" tal:condition="python: 'EnvClassThree' in [t.id for t in getattr(context, 'envclassthrees').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/envclassthrees/createObject?type_name=EnvClassThree'">
                   <img class="urban-add-icon" src="icon_add.gif" />
	  	 </a><br/>
                 <a class="contenttype-envclassone" href="envclassones" i18n:translate="envclassones">Environmental licence class 1</a>
                 <a href="" tal:condition="python: 'EnvClassOne' in [t.id for t in getattr(context, 'envclassones').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/envclassone/createObject?type_name=EnvClassOne'">
                   <img class="urban-add-icon" src="icon_add.gif" />
                 </a><br/>

                 <a class="contenttype-miscdemand" href="miscdemands" i18n:translate="miscdemands">Miscellaneous Demands</a>
                 <a href="" tal:condition="python: 'MiscDemand' in [t.id for t in getattr(context, 'miscdemands').allowedContentTypes()]"
                            tal:attributes="href python: context.absolute_url() + '/miscdemands/createObject?type_name=MiscDemand'">
                            <img class="urban-add-icon" src="icon_add.gif" />
                </a><br/>
                </td>
                <td width=33%>
                 <img src="../link_icon.gif" /> <a href="fullmap" i18n:translate="urban_fullmap_descr">Full map</a><br/>
                 <img src="../link_icon.gif" /> <a href="urbansearchview" i18n:translate="urban_search_descr">Search</a><br/>
                 <img src="../engrenage.png" /> <a href="urbanstatsview" i18n:translate="urban_statistics">Statistics</a><br/>
                 <img src="../engrenage.png" /> <a href="exportlist220" i18n:translate="urban_export_list220">Export list 220</a><br/>
                 <img src="../engrenage.png" /> <a href="statsins" i18n:translate="urban_statistics_ins">Statistics INS</a><br/>
                </td>
                <td width=33%>
                 <img src="../folder_icon.gif" /> <a href="architects" i18n:translate="manage_architects">Manage architects</a><br/>
                 <img src="../folder_icon.gif" /> <a href="notaries" i18n:translate="manage_notaries">Manage notaries</a><br/>
                 <img src="../folder_icon.gif" /> <a href="geometricians" i18n:translate="manage_geometricians">Manage geometricians</a><br/>
                 <img src="../folder_icon.gif" /> <a href="parcellings" i18n:translate="manage_parcellings">Manage parcellings</a><br/>
                 <br/>
                 <div tal:condition="isUrbanManager">
                  <img src="../maintenance_icon.png" /> <a href="portal_urban" i18n:translate="portal_urban">Urban configuration</a><br/>
                 </div>
                </td>
            </tr>
        </table>
        </div>

        <div tal:replace="structure provider:plone.abovecontentbody" />

        <fieldset style="margin: 0" tal:define="tool python: getattr(context, 'portal_urban');">
         <legend i18n:domain="urban" i18n:translate="search-last-elements">Last elements</legend>


         <div>
          <metal:listing use-macro="context/@@urban-macros/filter_listing" />
          <tal:listing content="structure view/renderLicenceListing" />
         </div>
         </fieldset>

    </metal:body>
    <div tal:replace="structure provider:plone.belowcontentbody" />

</metal:main_macro>

</div>

</body>
</html>
