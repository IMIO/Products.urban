<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xml:lang="en" lang="en"
      i18n:domain="urban"
      metal:use-macro="here/main_template/macros/master">

<metal:block fill-slot="top_slot"
             tal:define="dummy python:request.set('disable_border',1)" />

<body>
<div metal:fill-slot="main">
<div tal:define="foldertypes python: request.get('foldertypes', ['BuildLicence']);
                 search_arg request/search_arg|nothing;
                 previous_search_by request/search_by|nothing;
                 licence_types view/getLicenceTypes;">
<h1 class="documentFirstHeading" i18n:translate="urban_search_descr">Search licences</h1>

<tal:comment replace="nothing">Back to the build licence...</tal:comment>
<metal:listing use-macro="here/@@globalmacros/goBackToMacro" />

<fieldset><legend><strong i18n:translate="urban_search_parameters">Enter your parameters for the search</strong></legend>
 <form action="" method="get" id="search"
       tal:define="divisions view/getDivisions|nothing">
 <div tal:repeat="licence_type licence_types">
         <input id="foldertypes" type="checkbox" name="foldertypes"
         tal:define="type_checked python:licence_type in foldertypes or False"
         tal:attributes="value licence_type;checked python: type_checked and 'checked' or ''" />
  <label tal:content="licence_type" i18n:domain="plone" i18n:translate="">Licence type</label><br />
 </div>
 <br/>
 <a id="base_url" tal:attributes="href python: '%s/urbansearchview#fieldsetlegend-urban_searchby' % context.absolute_url()" ></a>
 <input id=search_by name=search_by type=hidden tal:attributes="value previous_search_by">
 <div id="urbanViewWithTabbing">
 <dl class="formTabs enableFormTabbing">
  <dt class="formTab" id="fieldsetlegend-urban_searchbystreet">
    <span i18n:translate="urban_search_parcel_by_location">Street</span>
  </dt>
  <dd id="fieldset-urban_searchbystreet"
   onmouseover="document.getElementById('search').elements['search_by'].value='street';
   var base_url=document.getElementById('base_url');
   var search_form=document.getElementById('search');
   search_form.setAttribute('action', base_url.getAttribute('href')+'street')">
  <metal:listing use-macro="context/@@urbansearch-macros/searchbystreetMacro" />
  </dd>
  <dt class="formTab" id="fieldsetlegend-urban_searchbyfolderreference">
    <span i18n:translate="urban_search_parcel_by_folder_reference">Folder reference</span>
  </dt>
  <dd id="fieldset-urban_searchbyfolderreference"
   onmouseover="document.getElementById('search').elements['search_by'].value='folderref';
   var base_url=document.getElementById('base_url');
   var search_form=document.getElementById('search');
   search_form.setAttribute('action', base_url.getAttribute('href')+'folderreference')">
  <metal:listing use-macro="context/@@urbansearch-macros/searchbyfolderreferenceMacro" />
  </dd>
  <dt class="formTab" id="fieldsetlegend-urban_searchbyname">
    <span i18n:translate="urban_search_parcel_by_name">Name</span>
  </dt>
  <dd id="fieldset-urban_searchbyname"
   onmouseover="document.getElementById('search').elements['search_by'].value='name';
   var base_url=document.getElementById('base_url');
   var search_form=document.getElementById('search');
   search_form.setAttribute('action', base_url.getAttribute('href')+'name')">
   <metal:listing use-macro="context/@@urbansearch-macros/searchbynameMacro" />
  </dd>
  <dt class="formTab" id="fieldsetlegend-urban_searchbyparcel">
    <span i18n:translate="urban_search_parcel_by_cadastral_reference">Parcel</span>
  </dt>
  <dd id="fieldset-urban_searchbyparcel"
   onmouseover="document.getElementById('search').elements['search_by'].value='parcel';
   var base_url=document.getElementById('base_url');
   var search_form=document.getElementById('search');
   search_form.setAttribute('action', base_url.getAttribute('href')+'parcel')">
  <p tal:condition="not: divisions" i18n:translate="help_search_connection_problem">
   You can not search folders by parcels for now because there was a problem.  Please contact your system administrator and give him the red error message here above
  </p>
  <span tal:condition="divisions"><metal:listing use-macro="context/@@urbansearch-macros/searchbyparcelMacro" /></span>
 </dd>
 </dl>
 </div>
 <br />
 <input class="context" type="submit" value="Search" name="Search" i18n:attributes="value">
 <br />
 <br />
</form>
</fieldset>

<!-- Display results -->
<tal:block_results condition="python: previous_search_by">

<table tal:define="brains view/searchLicence"
       class="listing" width=100% border=0 cellspacing=0>
 <thead>
  <tr>
   <th><strong i18n:translate="urban_search_result">Search result</strong></th>
  </tr>
 </thead>
 <!-- Display 'no results' -->
 <tbody tal:condition="not: brains">
  <tr>
   <td i18n:domain="atcontenttypes" i18n:translate="description_no_items_in_topic" class="discreet">No result found.
   </td>
  </tr>
 </tbody>
 <!-- Display the results body -->
 <tbody tal:condition="brains">
         <div>
          <tal:listing content="structure python: view.renderSearchResultListing(brains)" />
         </div>
 </tbody>
</table>

</tal:block_results>

</div>
</div>
</body>
</html>
