
<div metal:define-macro="urbanEventsMacro" i18n:domain="urban">
 <table cellspacing=0 cellpadding=0 width=100%>
 <tr>
  <td tal:define="eventTypes view/getUrbanEventTypes">
   <form action="createUrbanEvent" method="POST"
         tal:condition="view/canAddUrbanEvent">
    <input type='hidden' name="urban_folder_uid" tal:attributes="value here/UID" value=''>
    <select name="urban_event_type_uid">
     <tal:loopEventType repeat="eventType eventTypes">
      <option tal:attributes="value eventType/UID" value='' tal:content="eventType/Title">
      </option>
     </tal:loopEventType>
    </select>
    <input class="urbanButton contenttype-urbanevent button-urbanevent" type="submit" i18n:attributes="value" value="Add an event">
   </form>
   <p class="discreet" tal:condition="not: eventTypes" i18n:translate="urban_no_eventtype_defined">No event type is defined in the configuration for this element</p>
   <br />
  </td>
 </tr>
 <tr>
  <td>
    <div>
     <tal:listing content="structure view/renderEventsListing" />
    </div>
  </td>
 </tr>
 </table>
</div>


<div metal:define-macro="urbanAdvicesEventsMacro" i18n:domain="urban">
 <div tal:condition="view/canAddAllAdvices" >
 <fieldset><legend i18n:translate="folder_advice">Folder advices</legend>
  <table cellspacing=0 cellpadding=0 width=100%>
  <tr>
   <td>
    <form action="createAllAdvices" method="POST">
     <input class="urbanButton contenttype-urbanevent button-urbanevent" type="submit" i18n:attributes="value" value="Add all advices">
    </form>
    <div class="discreet">
     <span i18n:translate="add_every_advices_descr">This will automatically generate following advices:</span>&nbsp;
     <span tal:content="view/getAdviceTitles" />
    </div>
   </td>
  </tr>
  </table>
 </fieldset>
 </div>
</div>


<div metal:define-macro="warnings_macro" i18n:domain="urban">
 <div>
 </div>
</div>


<div metal:define-macro="investigation_and_advices_macro" i18n:domain="urban"
     tal:define="ctype python: context.portal_types.getTypeInfo('Inquiry');
                 inquiries view/getInquiriesForDisplay;
                 member context/@@plone_portal_state/member;">
<fieldset tal:repeat="inquiry inquiries"><legend><span class="contenttype-inquiry" i18n:translate="inquiry_title_and_number">Inquiry <span i18n:name="number" tal:content="repeat/inquiry/number"></span></span></legend>
<tal:comment replace="nothing">Do not show the actions on the Licence object representing the first inquiry, only on following ones wich are real Inquiry objects</tal:comment>
<tal:actions condition="python: not repeatindex == 0" define="repeatindex repeat/inquiry/index;
                                  thisObject python: inquiry;
                                  needExternalEdition python:False;
                                  actionsToHide python: ('transitions',);">
     <span metal:use-macro="here/urban_macros/macros/urbanActionsMacro" />
</tal:actions>
<table class="no-style-table">
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_derogation">Derogations</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('derogation', mode='view')" /></td>
 </tr>
 <tr tal:condition="python: context.attributeIsUsed('derogationDetails')">
  <td valign="top"><b><span i18n:translate="urban_label_derogationDetails">Derogations details</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><tal:block replace="structure inquiry/getDerogationDetails" /><span tal:condition="not: inquiry/getDerogationDetails" class="discreet" i18n:translate="content_none">None</span></td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_investigationArticles">Investigation articles</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('investigationArticles', mode='view')" /></td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_investigationStart">from</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('investigationStart', mode='view')" /><span tal:condition="not: inquiry/getInvestigationStart" class="discreet" i18n:translate="content_none">None</span></td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_investigationEnd">to</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('investigationEnd', mode='view')" /><span tal:condition="not: inquiry/getInvestigationEnd" class="discreet" i18n:translate="content_none">None</span></td>
 </tr>
 <tr tal:condition="python: context.attributeIsUsed('investigationDetails')">
  <td valign="top"><b><span i18n:translate="urban_label_investigationDetails">Investigation details</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><tal:block replace="structure inquiry/getInvestigationDetails" /><span tal:condition="not: inquiry/getInvestigationDetails" class="discreet" i18n:translate="content_none">None</span></td>
 </tr>
 <tr tal:condition="python: context.attributeIsUsed('investigationReasons')">
  <td valign="top"><b><span i18n:translate="urban_label_investigationReasons">Investigation reasons</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><tal:block replace="structure inquiry/getInvestigationReasons" /><span tal:condition="not: inquiry/getInvestigationReasons" class="discreet" i18n:translate="content_none">None</span></td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_solicitOpinionsTo">Solicit opinion to</span>:</b></td>
  <td width="2%"></td>
  <td tal:define="opinionIds inquiry/getSolicitOpinionsTo" style="padding-top: 1em;">
    <table tal:condition="opinionIds" cellspacing="0" cellpadding="0" width="100%" class="listing">
     <thead>
      <tr>
       <th i18n:translate="urban_label_requestedOrganisation">Organisation</th>
       <th i18n:translate="urban_label_eventDate">Date</th>
       <th i18n:translate="urban_label_receiptDate">Receipt date</th>
       <th i18n:translate="urban_label_adviceAgreementLevel">Advice agreement level</th>
      </tr>
     </thead>
     <tbody tal:define="tool python: context.portal_urban">
     <tr tal:repeat="opinionId opinionIds">
      <tal:block define="opinion python: inquiry.getLinkedUrbanEventOpinionRequest(opinionId)">
       <tal:anEventIsLinked condition="python: opinion is not None">
        <td><a href="#" tal:attributes="href opinion/absolute_url" tal:content="python: inquiry.getSolicitOpinionValue(opinionId)">Opinion request</a></td>
        <td tal:define="eventDate opinion/getEventDate"><span class="#" tal:attributes="class python: eventDate and 'plain' or 'discreet'" tal:content="python: eventDate and tool.formatDate(eventDate, translatemonth=False) or 'content_none'" i18n:translate="">None</span></td>
        <td tal:define="receiptDate opinion/getReceiptDate"><span class="#" tal:attributes="class python: receiptDate and 'plain' or 'discreet'" tal:content="python: receiptDate and tool.formatDate(receiptDate, translatemonth=False) or 'content_none'" i18n:translate="">None</span></td>
        <td tal:define="adviceAgreementLevel opinion/getAdviceAgreementLevel"><span class="#" tal:attributes="class python: adviceAgreementLevel and 'plain' or 'discreet'" tal:content="python: adviceAgreementLevel and adviceAgreementLevel or 'content_none'" i18n:translate="">None</span></td>
       </tal:anEventIsLinked>
       <tal:noEventIsLinked condition="python: opinion is None">
        <td tal:content="python: inquiry.getSolicitOpinionValue(opinionId)">Opinion request</td>
        <td><span class="discreet" i18n:translate="content_none">None</span></td>
        <td><span class="discreet" i18n:translate="content_none">None</span></td>
        <td><span class="discreet" i18n:translate="content_none">None</span></td>
       </tal:noEventIsLinked>
      </tal:block>
     </tr>
     </tbody>
    </table>
  </td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_investigationOralReclamationNumber">Number of oral reclamations</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('investigationOralReclamationNumber', mode='view')" /></td>
 </tr>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_label_investigationWriteReclamationNumber">Number of write reclamations</span>:</b></td>
  <td width="2%"></td>
  <td valign="top"><metal:myfield use-macro="python:inquiry.widget('investigationWriteReclamationNumber', mode='view')" /></td>
 </tr>
 <tal:comment replace="nothing">Link to the UrbanEventInquiry if exists</tal:comment>
 <tr>
  <td valign="top"><b><span i18n:translate="urban_linked_urbaneventinquiry">Linked urban event inquiry</span>:</b></td>
  <td width="2%"></td>
  <td valign="top" tal:define="linkedUrbanEventInquiry python: inquiry.getLinkedUrbanEventInquiry();">
   <a tal:condition="python: linkedUrbanEventInquiry" href="#" tal:attributes="href python:linkedUrbanEventInquiry.absolute_url()" i18n:translate="urban_link_to_the_linked_urbaneventinquiry">Click here to access the linked urban event inquiry</a>
   <span tal:condition="python: not linkedUrbanEventInquiry" class="discreet" i18n:translate="content_no_urbaneventinquiry">There is no UrbanEventInquiry linked to this inquiry</span>
  </td>
 </tr>
</table>
</fieldset>
<br />
<form tal:condition="python: member.has_permission('urban: Add Inquiry', context)" i18n:domain="urban" name="quickAdd" tal:attributes="action python: context.absolute_url() + '/createObject'" action="createObject" method="post">
 <input type="hidden" name="type_name" value="#" tal:attributes="value ctype/id" />
 <input type="submit" class="contenttype-inquiry button-inquiry" id="event" value="add_an_inquiry" i18n:attributes="value" />
</form>
</div>


