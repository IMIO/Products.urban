<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="urban">
<head>
<metal:block fill-slot="top_slot"
             tal:define="member context/@@plone_portal_state/member;
                         border python: member.has_permission('Modify portal content', context) and 'enable_border' or 'disable_border';
                         dummy python:request.set(border, 1);" />
</head>

<body>
<div metal:fill-slot="main">
<metal:main_macro define-macro="main">
<metal:body define-macro="body_macro" tal:define="linkedUrbanEventType view/getUrbaneventtypes;
                                                  member context/@@plone_portal_state/member;">

<metal:titleWithIcon use-macro="here/urban_macros/macros/titleWithIcon" />

<div tal:replace="structure provider:plone.belowcontenttitle" />

<tal:comment replace="nothing">Go back...</tal:comment>
<metal:listing use-macro="here/urban_macros/macros/goBackToMacro" />

<table width=100%>
    <tr valign="top">
        <td width=35%>
         <metal:listing use-macro="context/@@urbanevent-macros/urbanEventDataMacro" />
         <metal:listing use-macro="context/@@urbanevent-macros/urbanEventGenerateDocumentMacro" />
        </td>
        <td width=65%>
         <fieldset><legend i18n:translate="event_linked_documents">Event linked documents</legend>
          <div tal:define="tool python: context.portal_urban;
                           batch python: tool.queryCatalog(batch=True, specificSearch='searchLinkedDocuments', context=context, theObjects=False, batchlen=50);
                           showedCols python: ('Title', 'created', 'Creator', );
                           showActions python: True;">
          <metal:listing use-macro="here/urban_macros/macros/listing" />
          </div>
         </fieldset>
        </td>
   </tr>
   <tr valign="top">
        <td width=35%>
         <metal:listing use-macro="context/@@urbanevent-macros/urbanEventAddAnnexMacro" />
        </td>
        <td width=65%>
         <fieldset><legend i18n:translate="event_linked_annexes">Event linked annexes</legend>
          <div tal:define="tool python: context.portal_urban;
                           batch python: tool.queryCatalog(batch=True, specificSearch='searchLinkedAnnexes', context=context, theObjects=False, batchlen=50);
                           showedCols python: ('Title', 'created', 'Creator', );
                           showActions python: True;">
          <metal:listing use-macro="here/urban_macros/macros/listing" />
          </div>
         </fieldset>
        </td>
    </tr>
</table>


<tal:block condition="python: context.REQUEST.get('doc_uid') != None">
<tal:block define="docObj python:context.uid_catalog(UID=context.REQUEST.get('doc_uid'))[0]">
<Script tal:content="python:'document.location = \''+docObj.getObject().absolute_url()+'/external_edit\';'" />
</tal:block>
</tal:block>

 </metal:body>
</metal:main_macro>
</div>
</body>
</html>
